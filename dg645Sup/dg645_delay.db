record(bo, "$(P)$(R)$(Q)DISABLE") 
{
    field(DESC, "Disable comms")
    field(PINI, "YES")
    field(VAL, "$(DISABLE=0)")
    field(OMSL, "supervisory")
    field(ZNAM, "COMMS ENABLED")
    field(ONAM, "COMMS DISABLED")
}

# Delay set

record(stringout,"$(P)$(R)$(Q)Delay:SP")
{
    field(DESC, "Chan $(Q) setpoint")
    field(SCAN, "Passive")
}

record(mbbo,"$(P)$(R)$(Q)DelayUnit:SP")
{
    field(DESC, "Chan $(Q) unit setpoint")
    field(SCAN, "Passive")
    field(ZRST, "s")
    field(ONST, "ms")
    field(TWST, "us")
    field(THST, "ns")
    field(FRST, "ps")
    field(ZRVL, "0")
    field(ONVL, "3")
    field(TWVL, "6")
    field(THVL, "9")
    field(FRVL, "12")
    field(DTYP, "Soft Channel")
}

record(calcout,"$(P)$(R)$(Q)DelayUnitOut")
{
    field(DESC, "Chan $(Q) setpoint calc")
    field(SCAN, "Passive")
    field(INPA, "$(P)$(R)$(Q)Delay:SP")
    field(INPB, "$(P)$(R)$(Q)DelayUnit:SP.RVAL")
    field(CALC, "A*(10^(-1*B))")
    field(OUT, "$(P)$(R)$(Q)DelayAO")
    field(FLNK, "$(P)$(R)$(Q)DelayAO.PROC")
}

record(fanout,"$(P)$(R)$(Q)DelayButton")
{
    field(DESC, "Set Chan $(Q) setting button")
    field(SCAN, "Passive")
    field(LNK1, "$(P)$(R)$(Q)DelayUnitOut")
    field(LNK2, "$(P)$(R)$(Q)ReferenceSequence")
}

record(stringout,"$(P)$(R)$(Q)Reference:SP")
{
    field(DESC, "Chan $(Q) setpoint ref")
    field(SCAN, "Passive")
}

record(sseq,"$(P)$(R)$(Q)ReferenceSequence")
{
    field(DESC, "Chan $(Q) Reference set")
    field(SCAN, "Passive")
    field(DOL1, "$(P)$(R)$(Q)Reference:SP")
    field(LNK1, "$(P)$(R)$(Q)ReferenceMO")
    field(FLNK, "$(P)$(R)$(Q)ReferenceMO.PROC")
}

# Delay actual

record(calc,"$(P)$(R)$(Q)DelayConvert")
{
    field(PINI, "YES")
    field(DESC, "$(Q) value conversion")
    field(SCAN, "Passive")
    field(PREC, "12")
    field(INPA, "$(P)$(R)$(Q)DelayAI CP")
    field(CALC, "(A>1)?A:((A*1e3>1)?A*1e3:((A*1e6>1)?A*1e6:((A*1e9>1)?A*1e9:A*1e12)))")
}

record(ai,"$(P)$(R)$(Q)Delay:RB")
{
    field(DESC, "$(Q) value input")
    field(SCAN, "Passive")
    field(PREC, "8")
    field(INP, "$(P)$(R)$(Q)DelayConvert CP")
    field(ASG, "READONLY")
    info(INTEREST, "HIGH")
}

record(scalcout,"$(P)$(R)$(Q)DelayUnit:RB")
{
    field(PINI, "YES")
    field(DESC, "$(Q) unit conversion")
    field(SCAN, "Passive")
    field(INPA, "$(P)$(R)$(Q)DelayAI CP")
    field(CALC, "(A>1)?'s':((A*1e3>1)?'ms':((A*1e6>1)?'us':((A*1e9>1)?'ns':'ps')))")
    field(ASG, "READONLY")
    info(INTEREST, "HIGH")
}

# Delay width

record(calc,"$(P)$(R)$(Q)DelayWidth")
{
    field(PINI, "YES")
    field(DESC, "$(Q) Delay width")
    field(SCAN, "Passive")
    field(PREC, "12")
    field(INPA, "$(P)$(R)T0DelayAI CP")
    field(INPB, "$(P)$(R)T1DelayAI CP")
    field(INPC, "$(P)$(R)ADelayWidth CP")
    field(INPD, "$(P)$(R)BDelayWidth CP")
    field(INPE, "$(P)$(R)CDelayWidth CP")
    field(INPF, "$(P)$(R)DDelayWidth CP")
    field(INPG, "$(P)$(R)EDelayWidth CP")
    field(INPH, "$(P)$(R)FDelayWidth CP")
    field(INPI, "$(P)$(R)GDelayWidth CP")
    field(INPJ, "$(P)$(R)HDelayWidth CP")
    field(INPK, "$(P)$(R)$(Q)ReferenceMI.RVAL CP")
    field(INPL, "$(P)$(R)$(Q)DelayAI CP")
    field(CALC, "L+(K=0?A:(K=1?B:(K=2?C:(K=3?D:(K=4?E:(K=5?F:(K=6?G:(K=7?H:(K=8?I:J)))))))))")
}

record(scalcout,"$(P)$(R)$(Q)DelayWidthUnit:RB")
{
    field(PINI, "YES")
    field(DESC, "$(Q) Width unit convert")
    field(SCAN, "Passive")
    field(INPA, "$(P)$(R)$(Q)DelayWidth CP")
    field(CALC, "(A>1)?'s':((A*1e3>1)?'ms':((A*1e6>1)?'us':((A*1e9>1)?'ns':'ps')))")
    field(ASG, "READONLY")
    info(INTEREST, "HIGH")
}
