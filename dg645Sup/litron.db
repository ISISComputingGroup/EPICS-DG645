record(calc, "$(P)$(R)SUMMED_DLAY")
{
    field(INPA, "$(P)$(R)$(chan1=A)DELAY:RB CP MS")
    field(INPB, "$(P)$(R)$(chan2=C)DELAY:RB CP MS")
    field(CALC, "A+B")
    field(EGU, "us")
}

record(ai, "$(P)$(R)OFFSET")
{
    field(VAL, "0")
    field(EGU, "us")
}

record(ai, "$(P)$(R)DELAY")
{
    field(VAL, "0")
    field(EGU, "us")
}

record(calc, "$(P)$(R)SUMMED_VALUE")
{
    field(INPA, "$(P)$(R)DELAY CP")
    field(INPB, "$(P)$(R)OFFSET CP")
    field(CALC, "A+B")
    field(EGU, "us")
}

record(calc, "$(P)$(R)_MODE1CHECK")
{
    field(INPA, "$(P)$(R)$(chan2=C)DELAY:RB CP")
    field(INPB, "$(P)$(R)SUMMED_VALUE CP")
    field(CALC, "(A+B)>39900||B<0")
}

record(calc, "$(P)$(R)_MODE2CHECK")
{
    field(INPA, "$(P)$(R)$(chan2=C)DELAY:RB CP")
    field(INPB, "$(P)$(R)SUMMED_VALUE CP")
    field(CALC, "B>39900||(A+B)<=0")
}

record(calc, "$(P)$(R)_BOTHCHECKS")
{

    field(INPA, "$(P)$(R)SAVE_STATE CP")
    field(INPB, "$(P)$(R)_MODE1CHECK CP")
    field(INPC, "$(P)$(R)_MODE2CHECK CP")
    field(CALC, "(A=1)?B:C")

}

record(calc, "$(P)$(R)ERROR")
{
    field(INPA, "$(P)$(R)SAVE_STATE CP")
    field(INPB, "$(P)$(R)_BOTHCHECKS")
    field(CALC, "A=0||B")
}
